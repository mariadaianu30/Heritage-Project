@model OnlineShop.Models.Product
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = Model.Title;
}

<div class="product-detail-container">
    @* Product Image *@
    <div>
        @if (!string.IsNullOrEmpty(Model.ImagePath))
        {
            <img src="@Model.ImagePath"
                 class="product-detail-image"
                 alt="@Model.Title" />
        }
        else
        {
            <div class="product-detail-image d-flex align-items-center justify-content-center">
                <i class="fas fa-image fa-4x text-muted"></i>
            </div>
        }
    </div>

    @* Product Info *@
    <div class="product-detail-info">
        @if (Model.Category != null)
        {
            <span class="product-detail-brand">@Model.Category.Name</span>
        }
        
        <h1 class="product-detail-title">@Model.Title</h1>
        
        <div class="product-detail-price mb-4">
            @Model.Price.ToString("N2") RON
        </div>

        @if (!string.IsNullOrEmpty(Model.Description))
        {
            <div class="product-detail-description">
                @Html.Raw(Model.Description)
            </div>
        }

        @* Product Specs *@
        <ul class="product-detail-specs">
            @if (Model.Stock > 0)
            {
                <li><strong>Stoc:</strong> @Model.Stock bucăți disponibile</li>
            }
            else
            {
                <li><strong>Stoc:</strong> Indisponibil</li>
            }
            
            @if (Model.Category != null)
            {
                <li><strong>Categorie:</strong> @Model.Category.Name</li>
            }
            
            @if (Model.AverageRating.HasValue)
            {
                <li><strong>Rating:</strong> @Model.AverageRating.Value.ToString("N1") / 5</li>
            }
        </ul>

        @* Add to Cart & Wishlist *@
        @if (Model.IsAvailable && Model.Stock > 0 && !User.IsInRole("Admin"))
        {
            <div class="mt-4">
                <form asp-controller="Carts"
                      asp-action="Add"
                      method="post"
                      class="mb-3">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="productId" value="@Model.Id" />
                    
                    <div class="d-flex gap-3 align-items-end flex-wrap">
                        <div>
                            <label class="form-label">Cantitate</label>
                            <input type="number"
                                   name="quantity"
                                   value="1"
                                   min="1"
                                   max="@Model.Stock"
                                   class="form-control"
                                   style="width: 100px;" />
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            Adaugă în coș
                        </button>
                    </div>
                </form>

                @* Add to Wishlist *@
                @if (User.Identity!.IsAuthenticated &&
                            (User.IsInRole("User") || User.IsInRole("Collaborator")))
                {
                    <form asp-controller="Wishlists"
                          asp-action="Add"
                          method="post"
                          class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="productId" value="@Model.Id" />
                        <button type="submit" class="btn btn-secondary">
                            <i class="fas fa-heart me-1"></i>Adaugă la wishlist
                        </button>
                    </form>
                }
            </div>
        }
        else if (!Model.IsAvailable && Model.Stock == 0 && !User.IsInRole("Admin"))
        {
            <div class="alert alert-warning mt-4">
                Acest produs nu este disponibil momentan.
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Wishlist functionality can be added here if needed
    </script>
}
